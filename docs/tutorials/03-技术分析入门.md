# 📊 第3课：技术分析入门

> **⏱️ 预计阅读时间**: 25分钟  
> **🎯 学习目标**: 理解技术指标和 K 线形态的原理与应用  
> **📊 难度等级**: ⭐⭐⭐ 中级  
> **📋 前置知识**: 完成 [第2课：数据采集详解](./02-数据采集详解.md)

---

## 📋 本课概览

```
┌─────────────────────────────────────────────────────────────────┐
│                     第3课 学习路线                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1.技术分析基础   2.技术指标   3.K线形态    4.买卖信号          │
│   ┌─────┐       ┌─────┐      ┌─────┐      ┌─────┐            │
│   │什么是│ ──▶ │32种 │ ──▶ │61种 │ ──▶ │如何 │            │
│   │技术  │       │指标 │      │形态 │      │判断 │            │
│   │分析  │       │详解 │      │识别 │      │     │            │
│   └─────┘       └─────┘      └─────┘      └─────┘            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1️⃣ 技术分析基础

### 什么是技术分析？

```
┌─────────────────────────────────────────────────────────────────┐
│                   📈 技术分析 vs 基本面分析                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   基本面分析                      技术分析                       │
│   ┌───────────────┐             ┌───────────────┐              │
│   │ 研究公司内在   │             │ 研究价格走势   │              │
│   │               │             │               │              │
│   │ • 财务报表    │             │ • 历史价格    │              │
│   │ • 盈利能力    │             │ • 成交量      │              │
│   │ • 行业前景    │             │ • 技术指标    │              │
│   │ • 管理团队    │             │ • K线形态     │              │
│   │               │             │               │              │
│   │ 回答: 值多少钱│             │ 回答: 何时买卖│              │
│   └───────────────┘             └───────────────┘              │
│                                                                 │
│   💡 InStock 专注于技术分析，帮你判断买卖时机！                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 技术分析三大假设

```
┌─────────────────────────────────────────────────────────────────┐
│                   🔑 技术分析的三大假设                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   假设1: 市场行为包含一切信息                                    │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ 所有影响价格的因素（基本面、消息、情绪）                 │   │
│   │ 都已经反映在价格中了                                     │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   假设2: 价格沿趋势运动                                          │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ 价格会沿着某个方向持续运动，                             │   │
│   │ 直到出现反转信号                                         │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   假设3: 历史会重演                                              │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ 过去出现过的价格形态，                                   │   │
│   │ 未来很可能再次出现                                       │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2️⃣ 技术指标详解

### InStock 支持的 32 种指标

```
┌─────────────────────────────────────────────────────────────────┐
│                   📊 32 种技术指标分类                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   🔴 趋势指标 (判断涨跌方向)                                     │
│   ├── MACD   - 异同移动平均线 ⭐最常用                          │
│   ├── BOLL   - 布林带                                           │
│   ├── SAR    - 抛物线指标                                       │
│   ├── DMA    - 平均差                                           │
│   └── TEMA   - 三重指数移动平均                                 │
│                                                                 │
│   🟡 震荡指标 (判断超买超卖)                                     │
│   ├── KDJ    - 随机指标 ⭐最常用                                │
│   ├── RSI    - 相对强弱指标                                     │
│   ├── CCI    - 顺势指标                                         │
│   ├── WR     - 威廉指标                                         │
│   └── ROC    - 变动率指标                                       │
│                                                                 │
│   🟢 成交量指标 (判断量能)                                       │
│   ├── OBV    - 能量潮                                           │
│   ├── VR     - 成交量变异率                                     │
│   └── MFI    - 资金流量指标                                     │
│                                                                 │
│   🔵 波动指标 (判断波动幅度)                                     │
│   ├── ATR    - 平均真实波幅                                     │
│   ├── BRAR   - 情绪指标                                         │
│   └── EMV    - 简易波动指标                                     │
│                                                                 │
│   ⚪ 其他指标                                                    │
│   ├── DMI    - 趋向指标                                         │
│   ├── CR     - 能量指标                                         │
│   ├── PSY    - 心理线                                           │
│   ├── BIAS   - 乖离率                                           │
│   └── ... 更多                                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 重点指标详解

#### 📊 MACD - 异同移动平均线

```
┌─────────────────────────────────────────────────────────────────┐
│                   📈 MACD 指标详解                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   组成部分:                                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ DIF  = 快线 (12日EMA - 26日EMA)                         │   │
│   │ DEA  = 慢线 (DIF的9日EMA)                               │   │
│   │ MACD = 柱状图 (DIF - DEA) × 2                           │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   信号解读:                                                      │
│                                                                 │
│   🟢 金叉买入信号                    🔴 死叉卖出信号             │
│   ┌─────────────────┐              ┌─────────────────┐         │
│   │      DIF        │              │      DEA        │         │
│   │        ╲        │              │        ╲        │         │
│   │         ╲       │              │         ╲       │         │
│   │    DEA   ╳      │              │    DIF   ╳      │         │
│   │           ╲     │              │           ╲     │         │
│   │            ↓    │              │            ↓    │         │
│   │       买入! 🟢  │              │       卖出! 🔴  │         │
│   └─────────────────┘              └─────────────────┘         │
│                                                                 │
│   DIF 从下向上穿过 DEA             DIF 从上向下穿过 DEA         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 📊 KDJ - 随机指标

```
┌─────────────────────────────────────────────────────────────────┐
│                   📈 KDJ 指标详解                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   组成部分:                                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ K 值 = 快速随机值 (最敏感)                               │   │
│   │ D 值 = K 的移动平均 (较平滑)                             │   │
│   │ J 值 = 3K - 2D (最敏感，可超出0-100)                     │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   区域划分:                                                      │
│                                                                 │
│   100 ─────────────────────────────────────                     │
│                                                                 │
│    80 ═══════════════════════════════════ ← 超买区 (考虑卖出)  │
│          危险区域，价格可能回落                                  │
│    50 ─────────────────────────────────── ← 中性区             │
│          观望区域                                                │
│    20 ═══════════════════════════════════ ← 超卖区 (考虑买入)  │
│          机会区域，价格可能反弹                                  │
│     0 ─────────────────────────────────────                     │
│                                                                 │
│   🟢 K>80 且 J>90 → 超买，准备卖出                              │
│   🔴 K<20 且 J<10 → 超卖，准备买入                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 📊 RSI - 相对强弱指标

```
┌─────────────────────────────────────────────────────────────────┐
│                   📈 RSI 指标详解                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   计算公式:                                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ RSI = 100 - 100/(1 + RS)                                │   │
│   │ RS = 平均上涨幅度 / 平均下跌幅度                         │   │
│   │                                                         │   │
│   │ 常用周期: RSI(6), RSI(12), RSI(24)                      │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   区域解读:                                                      │
│                                                                 │
│   RSI值        状态          操作建议                           │
│   ──────────────────────────────────────────                    │
│   > 80        严重超买       🔴 强烈卖出信号                    │
│   70-80       超买           🟡 注意风险                        │
│   30-70       正常           ⚪ 观望                            │
│   20-30       超卖           🟡 关注机会                        │
│   < 20        严重超卖       🟢 强烈买入信号                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 指标计算代码位置

```
文件位置: instock/core/indicator/calculate_indicator.py

代码结构:
├── calculate_macd()    # MACD 计算
├── calculate_kdj()     # KDJ 计算
├── calculate_rsi()     # RSI 计算
├── calculate_boll()    # BOLL 计算
└── ... 其他 28 种指标
```

---

## 3️⃣ K 线形态识别

### K 线基础知识

```
┌─────────────────────────────────────────────────────────────────┐
│                   📊 K 线基础                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   阳线 (收盘 > 开盘)                阴线 (收盘 < 开盘)           │
│                                                                 │
│        最高价 ─┐                         最高价 ─┐              │
│                │ 上影线                          │ 上影线       │
│        ┌───────┴───────┐                ┌───────┴───────┐      │
│        │               │                │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│      │
│        │    🟢 红色    │ ← 收盘价       │▓▓▓▓ 🔴 绿色 ▓▓│←开盘 │
│        │    (涨)      │                │▓▓▓▓  (跌)   ▓▓│      │
│        │               │ ← 开盘价       │▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│←收盘 │
│        └───────┬───────┘                └───────┬───────┘      │
│                │ 下影线                          │ 下影线       │
│        最低价 ─┘                         最低价 ─┘              │
│                                                                 │
│   💡 中国股市: 红涨绿跌 (与美股相反)                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### InStock 支持的 61 种 K 线形态

```
┌─────────────────────────────────────────────────────────────────┐
│                   🔍 61 种 K 线形态分类                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   🔴 看跌形态 (卖出信号)                                         │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • 两只乌鸦      • 三只乌鸦      • 乌云盖顶              │   │
│   │ • 暮星          • 十字暮星      • 上吊线                │   │
│   │ • 射击之星      • 墓碑十字      • 三线打击              │   │
│   │ • 向上跳空两只乌鸦 ...                                  │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   🟢 看涨形态 (买入信号)                                         │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • 锤头          • 倒锤头        • 晨星                  │   │
│   │ • 十字晨星      • 三白兵        • 刺透形态              │   │
│   │ • 弃婴          • 曙光初现      • 南方三星              │   │
│   │ • 上升三法      • 梯底 ...                              │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   ⚪ 中性/反转形态                                               │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ • 十字星        • 蜻蜓十字      • 长脚十字              │   │
│   │ • 纺锤          • 身怀六甲      • 高浪线                │   │
│   │ • 捉腰带线      • 反击线 ...                            │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 重点形态详解

#### 🔨 锤头形态 (看涨)

```
┌─────────────────────────────────────────────────────────────────┐
│                   🔨 锤头形态详解                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   形态特征:                                                      │
│   ┌───────────────────────────────────────┐                    │
│   │                                       │                    │
│   │           ┌───┐ ← 小实体              │                    │
│   │           │   │                       │                    │
│   │           └─┬─┘                       │                    │
│   │             │                         │                    │
│   │             │ ← 长下影线              │                    │
│   │             │    (实体2倍以上)        │                    │
│   │             │                         │                    │
│   │                                       │                    │
│   └───────────────────────────────────────┘                    │
│                                                                 │
│   出现位置: 下跌趋势末端                                         │
│   信号强度: ⭐⭐⭐                                               │
│                                                                 │
│   解读:                                                          │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ 1. 开盘后大幅下跌 (空方力量)                             │   │
│   │ 2. 随后强力反弹收复失地 (多方反击)                       │   │
│   │ 3. 说明下方有强支撑，可能反转向上                        │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### ⭐ 晨星形态 (看涨)

```
┌─────────────────────────────────────────────────────────────────┐
│                   ⭐ 晨星形态详解                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   形态特征 (三根K线组合):                                        │
│   ┌───────────────────────────────────────────────────────┐    │
│   │                                                       │    │
│   │   第1天         第2天         第3天                   │    │
│   │  ┌─────┐                     ┌─────┐                 │    │
│   │  │▓▓▓▓▓│                     │     │                 │    │
│   │  │▓▓▓▓▓│                     │     │                 │    │
│   │  │▓▓▓▓▓│       ┌───┐        │     │                 │    │
│   │  │▓▓▓▓▓│       │   │        │     │                 │    │
│   │  └──┬──┘       └───┘        └─────┘                 │    │
│   │     │                                                │    │
│   │   大阴线      小实体/十字     大阳线                  │    │
│   │   (下跌)      (犹豫)         (反转)                  │    │
│   │                                                       │    │
│   └───────────────────────────────────────────────────────┘    │
│                                                                 │
│   出现位置: 下跌趋势末端                                         │
│   信号强度: ⭐⭐⭐⭐⭐ (非常强)                                   │
│                                                                 │
│   解读:                                                          │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ 1. 第1天: 继续下跌，空方占优                             │   │
│   │ 2. 第2天: 多空平衡，出现犹豫                             │   │
│   │ 3. 第3天: 多方反攻，趋势反转                             │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 🌑 乌云盖顶 (看跌)

```
┌─────────────────────────────────────────────────────────────────┐
│                   🌑 乌云盖顶详解                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   形态特征 (两根K线组合):                                        │
│   ┌───────────────────────────────────────────────────────┐    │
│   │                                                       │    │
│   │           第1天              第2天                    │    │
│   │                           ┌─────┐                    │    │
│   │          ┌─────┐         │▓▓▓▓▓│ ← 高开             │    │
│   │          │     │         │▓▓▓▓▓│                    │    │
│   │          │     │  ───────│▓▓▓▓▓│── 深入50%以上     │    │
│   │          │     │         │▓▓▓▓▓│                    │    │
│   │          │     │         └──┬──┘                    │    │
│   │          └─────┘            │                        │    │
│   │                                                       │    │
│   │         大阳线            大阴线                      │    │
│   │         (上涨)           (高开低走)                   │    │
│   │                                                       │    │
│   └───────────────────────────────────────────────────────┘    │
│                                                                 │
│   出现位置: 上涨趋势末端                                         │
│   信号强度: ⭐⭐⭐⭐                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 形态识别结果解读

```
┌─────────────────────────────────────────────────────────────────┐
│                   📋 形态识别结果含义                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   返回值        含义              操作建议                       │
│   ──────────────────────────────────────────────────            │
│   正数 (+)      看涨信号          🟢 考虑买入                    │
│     0           无该形态          ⚪ 忽略                        │
│   负数 (-)      看跌信号          🔴 考虑卖出                    │
│                                                                 │
│   数值越大，信号越强                                             │
│                                                                 │
│   示例:                                                          │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ CDL_HAMMER = 100    → 出现锤头形态，强烈看涨            │   │
│   │ CDL_HAMMER = 0      → 未出现锤头形态                    │   │
│   │ CDL_ENGULFING = -100→ 出现看跌吞没，强烈看跌            │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4️⃣ 买卖信号判断

### InStock 的买卖信号规则

```
┌─────────────────────────────────────────────────────────────────┐
│                   🎯 买卖信号判断规则                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   🟢 买入信号                                                    │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ KDJ:  K<20 且 D<30 → 超卖区                             │   │
│   │ RSI:  RSI<20 → 严重超卖                                 │   │
│   │ CCI:  CCI<-100 → 超卖区                                 │   │
│   │ CR:   CR<40 → 建仓良机                                  │   │
│   │ WR:   WR>80 → 超卖状态                                  │   │
│   │ VR:   VR在40-70区间 → 低价区                            │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   🔴 卖出信号                                                    │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ KDJ:  K>80 且 D>70 且 J>90 → 超买区                     │   │
│   │ RSI:  RSI>80 → 严重超买                                 │   │
│   │ CCI:  CCI>100 → 超买区                                  │   │
│   │ CR:   CR上升到160 → 短线获利良机                        │   │
│   │ WR:   WR<20 → 超买状态                                  │   │
│   │ VR:   VR在160-450区间 → 获利区                          │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 多指标综合判断

```
┌─────────────────────────────────────────────────────────────────┐
│                   🔄 多指标综合判断示例                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   场景: 某股票当前状态                                           │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ KDJ:  K=15, D=18, J=9    → 🟢 超卖                      │   │
│   │ RSI:  RSI(6)=18          → 🟢 超卖                      │   │
│   │ MACD: 即将金叉           → 🟢 看涨                      │   │
│   │ 形态: 出现锤头           → 🟢 看涨                      │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   综合判断:                                                      │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │                                                         │   │
│   │   🟢 买入信号: 4 个                                     │   │
│   │   🔴 卖出信号: 0 个                                     │   │
│   │                                                         │   │
│   │   结论: ✅ 较强的买入机会                                │   │
│   │                                                         │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   ⚠️ 注意: 指标仅供参考，不构成投资建议！                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5️⃣ 代码实践

### 运行指标计算

```bash
# 在 instock/job/ 目录执行
python indicators_data_daily_job.py

# 或指定日期
python indicators_data_daily_job.py 2024-01-15
```

### 运行形态识别

```bash
# 在 instock/job/ 目录执行
python klinepattern_data_daily_job.py
```

### 查看计算结果

```sql
-- 查看指标数据
SELECT code, name, macd, kdj_k, kdj_d, rsi_6
FROM cn_stock_indicators_YYYYMMDD
WHERE kdj_k < 20  -- 找超卖的股票
LIMIT 20;

-- 查看形态识别结果
SELECT code, name, cdl_hammer, cdl_morningstar
FROM cn_stock_pattern_YYYYMMDD
WHERE cdl_hammer > 0  -- 找出现锤头形态的股票
LIMIT 20;
```

---

## 🎯 实践任务

### 任务1：理解 MACD 金叉

```sql
-- 找出 MACD 金叉的股票 (DIF > DEA 且前一天 DIF < DEA)
-- 这需要对比今天和昨天的数据
```

**🎯 目标**: 理解金叉的含义

### 任务2：找出超卖股票

```sql
-- 找出 KDJ 超卖的股票
SELECT code, name, kdj_k, kdj_d, kdj_j
FROM cn_stock_indicators_YYYYMMDD
WHERE kdj_k < 20 AND kdj_d < 30
ORDER BY kdj_k ASC
LIMIT 10;
```

**🎯 目标**: 找到潜在的买入机会

### 任务3：形态筛选

在 Web 界面上，使用形态识别功能，找出出现看涨形态的股票

**🎯 目标**: 熟悉形态识别的使用

---

## 🎓 知识检查

**1. MACD 金叉是指？**
- A) DIF 从上向下穿过 DEA
- B) DIF 从下向上穿过 DEA
- C) K 从下向上穿过 D
- D) RSI 突破 80

<details>
<summary>查看答案</summary>

**B) DIF 从下向上穿过 DEA**

这是买入信号，相反的死叉是卖出信号。

</details>

**2. KDJ 指标中，K=15 表示？**
- A) 超买状态
- B) 超卖状态
- C) 正常状态
- D) 无法判断

<details>
<summary>查看答案</summary>

**B) 超卖状态**

K < 20 表示超卖，意味着股价可能被低估，有反弹机会。

</details>

**3. 锤头形态通常出现在？**
- A) 上涨趋势中
- B) 下跌趋势末端
- C) 横盘整理中
- D) 任何时候

<details>
<summary>查看答案</summary>

**B) 下跌趋势末端**

锤头形态是底部反转信号，出现在下跌趋势末端时最有意义。

</details>

---

## 📖 本课小结

```
┌─────────────────────────────────────────────────────────────────┐
│                        📝 第3课 小结                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ✅ 技术分析通过历史价格预测未来走势                            │
│                                                                 │
│   ✅ 32种技术指标: MACD(趋势)、KDJ(超买卖)、RSI、BOLL...        │
│                                                                 │
│   ✅ 61种K线形态: 锤头(涨)、晨星(涨)、乌云盖顶(跌)...            │
│                                                                 │
│   ✅ 买卖信号需要多指标综合判断，不要依赖单一指标                │
│                                                                 │
│   ✅ 形态识别结果: 正数=看涨，负数=看跌，0=无形态                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📚 下一课预告

**[第4课：策略选股实战](./04-策略选股实战.md)**

你将学习：
- 🎯 内置的 11 种选股策略
- 📝 如何编写自定义策略
- ✅ 策略回测验证方法
- 📊 如何评估策略效果

---

> ⚠️ **投资提示**: 技术指标仅供参考，股市有风险，投资需谨慎！

**有问题？欢迎在 GitHub 提 Issue！** 🙋
